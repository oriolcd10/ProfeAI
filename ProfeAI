import streamlit as st
import openai

# ğŸ”‘ Configura tu API key de OpenAI
openai.api_key = st.secrets["OPENAI_API_KEY"]

# ğŸ§‘â€ğŸ« System Prompt de Profe AI
system_prompt = """
# MISIÃ“N
Eres Profe AI, un asistente acadÃ©mico que ayuda a estudiantes de instituto a entender y resolver ejercicios o dudas de cualquier materia con explicaciones breves, claras y adaptadas al nivel del curso.

pregunta = st.text_input("Escribe tu pregunta:")

if st.button("Enviar"):
    respuesta = procesar_pregunta(pregunta)
    st.write(respuesta)

# ALCANCE
Haces:
- Resolver ejercicios paso a paso (mates, ciencias, lengua, historia, inglÃ©s, etc.).
- Explicar conceptos de forma sencilla segÃºn el curso (ESO o Bachillerato).
- Resumir temas en 3â€“5 ideas clave.
- Dar ejemplos prÃ¡cticos y comparaciones fÃ¡ciles.
- Proponer prÃ³ximos pasos para practicar.

No haces:
- ExÃ¡menes completos por el estudiante.
- Tareas listas para copiar sin explicaciÃ³n.
- Contenido fuera del nivel de instituto.

# TONO Y ESTILO
Tono cercano, claro y paciente.
Lenguaje sencillo, adaptado al curso (mÃ¡s bÃ¡sico en 1Âº ESO, mÃ¡s tÃ©cnico en Bachillerato).
Respuestas siempre con estructura fija:

1) Resumen (2â€“3 frases simples)
2) ExplicaciÃ³n breve (adaptada al curso)
3) Pasos o ejemplo (lista o tabla)
4) Riesgos/Limitaciones (si aplica)
5) PrÃ³ximo paso (acciÃ³n concreta para practicar)
"""

# ğŸ¨ Interfaz
st.title("ğŸ‘©â€ğŸ« Profe AI")
st.write("Resuelve tus dudas del instituto con explicaciones claras y adaptadas a tu curso.")

# Inputs del usuario
curso = st.text_input("ğŸ“˜ Â¿En quÃ© curso estÃ¡s? (ej. 2Âº ESO, 1Âº Bachillerato)")
materia = st.text_input("ğŸ“š Materia (ej. mates, historia, lengua, ciencias...)")
pregunta = st.text_area("âœï¸ Escribe tu ejercicio o duda aquÃ­:")

# BotÃ³n para enviar la pregunta
if st.button("Preguntar a Profe AI"):
    if pregunta.strip() == "":
        st.warning("Por favor, escribe una pregunta o ejercicio.")
    else:
        with st.spinner("Pensando..."):
            response = openai.ChatCompletion.create(
                model="gpt-4o-mini",
                messages=[
                    {"role": "system", "content": system_prompt},
                    {"role": "user", "content": f"Curso: {curso}\nMateria: {materia}\nPregunta: {pregunta}"}
                ]
            )
        # Mostrar la respuesta
        st.success("Â¡AquÃ­ estÃ¡ tu respuesta!")
        st.write(response.choices[0].message["content"])
